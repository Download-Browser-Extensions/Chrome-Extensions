!function(a){var b="http://notification.appiance.com",c="messageHub",d=window.jQuery;chrome.notifications.onClicked.addListener(function(a){null!==f.links[a]&&f.links[a].length>0&&("http://"!=f.links[a].substring(0,7)&&"https:/"!=f.links[a].substring(0,7)&&(f.links[a]="http://"+f.links[a]),chrome.tabs.create({url:f.links[a]})),chrome.notifications.clear(a,function(){})});var e={error:0,initializing:1,initialized:2},f=a.notification={state:0,notif_id:"",notif_count:0,links:[],isInit:!1,connection:null,messageHubProxy:null,lastReceivedTimeStamp:function(a,b){return b||0==b?(localStorage["lastReceivedTimeStamp_"+a]=b,b):localStorage["lastReceivedTimeStamp_"+a]?localStorage["lastReceivedTimeStamp_"+a]:this.lastReceivedTimeStamp(a,0)},init:function(a){var b=a.Name.toLowerCase();if(this.state===e.initializing)return void(this.notif_id=b);if(this.state===e.initialized){var c=this.notif_id;return this.notif_id=b,void this.changeRegistration(this.notif_id,c)}this.notif_id=b,this.state=e.initializing;var f=this;this.messageHubProxy.on("broadcastMessage",function(a,b,c,e){var g={type:"basic",title:"",message:"",iconUrl:"http://www.visibay.com/api/app/logo?name="+f.notif_id};void 0==b?d.each(JSON.parse(a),function(a,b){g.title=b.Title,g.message=b.Message,f.lastReceivedTimeStamp(f.notif_id,parseInt(b.NotificationSendDate,10)),chrome.notifications.create(f.notif_id+f.notif_count,g,function(){f.links[f.notif_id+f.notif_count++]=b.Hyperlink})}):(g.title=a,g.message=b,void 0==e&&(e=0),f.lastReceivedTimeStamp(f.notif_id,parseInt(e,10)),chrome.notifications.create(f.notif_id+f.notif_count,g,function(){f.links[f.notif_id+f.notif_count++]=c}))}),f.connection.start().done(function(){f.messageHubProxy.invoke("register",f.notif_id,f.lastReceivedTimeStamp(f.notif_id)).done(function(){console.log("Registered for notifications on channel "+f.notif_id),f.state=e.initialized}).fail(function(){console.log("Could not register on channel "+f.notif_id),f.state=e.error})}).fail(function(){console.log("Could not connect to channel "+f.notif_id),f.state=e.error})},changeRegistration:function(a,b){a&&this.messageHubProxy.invoke("changeRegistration",b,a,this.lastReceivedTimeStamp(a)).done(function(){console.log("Registered for notifications on channel "+a)})}};f.connection=d.hubConnection(b),f.messageHubProxy=f.connection.createHubProxy(c)}(window);