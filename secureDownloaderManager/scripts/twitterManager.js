!function(a){function b(a){"function"==typeof a&&chrome.storage.local.get("TWITTER_APP_TOKEN",function(b){var c=null;b&&b.TWITTER_APP_TOKEN?(c=b.TWITTER_APP_TOKEN,a(c)):f("http://www.appiance.com/api/social/twittertoken",null,function(b){chrome.storage.local.set({TWITTER_APP_TOKEN:b.access_token}),c=b.access_token,a(c)})})}function c(a,c){b(function(b){f("https://api.twitter.com/1.1/statuses/user_timeline.json?screen_name="+a+"&count=10",{name:"Authorization",attr:"Bearer "+b},function(b){if(b){for(var e,f=[],h=0;h<b.length;h++)e=new Date(b[h].created_at),f.push({id:b[h].id_str,text:d(b[h]),date:e.getTime(),account:b[h].user.screen_name,name:b[h].user.name,logo:b[h].user.profile_image_url,type:"twitter"});g.twitterName[a].feed=f,g.twitterName[a].timeOut=!0,c(g.twitterName[a],g.currentApp)}})})}function d(a){var b=a.text;if(a.entities&&a.entities.urls.length>0)for(var c=0;c<a.entities.urls.length;c++)b=b.replace(a.entities.urls[c].url,"<a href="+a.entities.urls[c].expanded_url+">"+a.entities.urls[c].display_url+"</a>");return b}function e(){var a=0;for(i in g.twitterName)g.twitterName[i].timeOut&&(c(g.twitterName[i].name,g.twitterName[i].callback),a++);0!=a?setTimeout(e,9e5):g.timeOut=!1}function f(a,b,c){var d=new XMLHttpRequest;d.open("GET",a,!0),b&&d.setRequestHeader(b.name,b.attr),d.setRequestHeader("Accept","application/json"),d.onload=function(){200===this.status&&(res=this.responseText,"string"==typeof res&&(res=JSON.parse(res)),c(res))},d.onerror=function(){},d.send()}var g=a.twitterManager={twitterName:{},timeOut:!1,currentApp:null,checkTweet:function(a,b,d){if(g.timeOut||(g.timeOut=!0,setTimeout(e,9e5)),g.currentApp){if(g.currentApp!=a){for(i in g.twitterName)g.twitterName[i].timeOut=!1;g.currentApp=a}}else g.currentApp=a;g.twitterName[b]?(d(g.twitterName[b],g.currentApp),g.twitterName[b].timeOut=!0):(g.twitterName[b]={name:b,callback:d},c(b,d))},destroyTweet:function(a){if(g.currentApp!=a){for(i in g.twitterName)g.twitterName[i].timeOut=!1;g.currentApp=a}}}}(this);