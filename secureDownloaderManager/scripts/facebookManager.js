!function(a){function b(){var a=i.callbacks;i.callbacks=[];for(var b=0;b<a.length;++b)"function"==typeof a[b]&&a[b]()}function c(a){wndId==a&&(chrome.windows.onRemoved.removeListener(c),chrome.tabs.onUpdated.removeListener(d),b(null))}function d(a,c,e){if(e.url.indexOf(h)>=0){chrome.tabs.onUpdated.removeListener(d);for(var f,g=/[#&]([^=]+)[=]([^&]*)/gi,j={};null!==(f=g.exec(e.url));)j[f[1]]=f[2];var k=i.setDataFromSuccessUrl(j);b(k),chrome.tabs.remove(a)}}function e(a){var b="";if(Object.keys(a).length>1){b+="{";for(var c in a)a.hasOwnProperty(c)&&(b.length>2&&(b+=","),b+='"'+c+'":"'+a[c]+'"');b+="}"}else b+=a;return"?q="+encodeURIComponent(b)+"&access_token="+encodeURI(i.accessToken.getAccessToken())}{var f="142910072408993",g=f+"|9wmgsshPEMZhu2-WTSxFkzjgD6A",h="https://www.facebook.com/connect/login_success.html",i={callbacks:[],accessToken:{propNameToken:"facebook_access_token",getAccessToken:function(){return chrome.storage.local[this.propNameToken]?chrome.storage.local[this.propNameToken]:g},setAccessToken:function(a){a?chrome.storage.local[this.propNameToken]=a:chrome.storage.local.remove(this.propNameToken)},accessTokenExist:function(){return chrome.storage.local[this.propNameToken]}},sessionExpiration:{propNameExpiration:"facebook_expiration",getExpirationDate:function(){return chrome.storage.local[this.propNameExpiration]?new Date(chrome.storage.local[this.propNameExpiration]):null},setExpirationDate:function(a){a?chrome.storage.local[this.propNameExpiration]=a.toString():chrome.storage.local.remove(this.propNameExpiration)},expirationExist:function(){return chrome.storage.local[this.propNameExpiration]}},setDataFromSuccessUrl:function(a){var b=a.expires_in;if(b&&b.length){var c=new Date;c.setTime(c.getTime()+1e3*parseInt(b,10)),this.sessionExpiration.setExpirationDate(c)}var d=a.access_token;return d&&d.length&&this.accessToken.setAccessToken(d),d}};a.facebookManager={login:function(a){i.callbacks.push(a),chrome.tabs.onUpdated.addListener(d),chrome.windows.create({url:"https://www.facebook.com/dialog/oauth?client_id="+f+"&display=popup&response_type=token&scope=email&redirect_uri="+h,type:"popup",width:500,height:300},function(a){wndId=a.id,chrome.windows.onRemoved.addListener(c)})},logout:function(a){i.accessToken.setAccessToken(null),i.sessionExpiration.setExpirationDate(null),a()},status:function(a){a(!0,this.isLogged)},isLogged:function(){return i.accessToken.accessTokenExist()&&i.sessionExpiration.expirationExist()&&i.sessionExpiration.getExpirationDate()>new Date},fql:{query:function(a,b){var c=new XMLHttpRequest;c.open("GET","https://graph.facebook.com/fql"+e(a),!0),c.responseType="json",c.setRequestHeader("Accept","application/json"),c.onload=function(){if(200===this.status){var a=this.response;return"string"==typeof a&&(a=JSON.parse(a)),b(a)}return b(null)},c.onerror=function(){return b(null)},c.send()}}}}}(this);