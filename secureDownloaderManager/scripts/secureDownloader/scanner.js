!function(a,b,c){"use strict";var d,e,f,g,h,i,j,k,l,m,n,o,p,q,r,s=0;d=angular.module("sdl:scanner",[]),e=d.filter("i18n",function(){return function(a,b){return a?c.i18n.getMessage(a,b):void 0}}),f=d.controller("scanCtrl",function($scope,$window,$timeout){$scope.isWhiteList=!0,$scope.downloadItem=null,$scope.scanreport={},$scope.isVideo=!1,$scope.Clean="safe",$scope.isVerif=!1,$scope.showReport=!1,$scope.downloadComplete=!1,$scope.isResend=!1,$scope.popupDelete=!1,$scope.percent=0,$scope.textDeletePopup="cancel",$scope.openDownload=function(a){if($scope.downloadItem){var b="";"folder"===a?(c.downloads.show($scope.downloadItem.id),b="openFolder"):"file"===a&&(c.downloads.open($scope.downloadItem.id),b="openFile"),r(b,{wlist:$scope.isWhiteList,downloadItem:$scope.downloadItem,isReport:$scope.isVerif,clean:$scope.Clean,nbReport:s})}},$scope.openPopupDelete=function(a){n(),$scope.textDeletePopup=a,c.downloads.search({id:$scope.downloadItem.id},function(a){"in_progess"==a.state&&c.downloads.pause($scope.downloadItem.id)}),$scope.popupDelete=!0},$scope.deleteDownload=function(){c.downloads.search({id:$scope.downloadItem.id},function(a){console.log(a);var b="";"complete"==a[0].state?(console.log("remove"),c.downloads.removeFile($scope.downloadItem.id,function(){c.downloads.erase({id:$scope.downloadItem.id}),c.tabs.remove(m)}),b="removeFile"):(console.log("cancel"),c.downloads.erase({id:$scope.downloadItem.id},function(){c.tabs.remove(m)}),b="cancelFile"),r(b,{wlist:$scope.isWhiteList,downloadItem:$scope.downloadItem,isReport:$scope.isVerif,clean:$scope.Clean,nbReport:s})})},$scope.resumeDownload=function(){$scope.downloadComplete||o(),$scope.popupDelete=!1,$scope.downloads.resume($scope.downloadItem.id)},$scope.resend=function(){$scope.isVerif=!1,$scope.isVideo=$scope.isResend=!0,i()},j=function(){$scope.isVideo=!1,$scope.$apply()},l=function(a){s=0,$scope.scansReport=[],Object.keys(a).forEach(function(b){$scope.scansReport.push({name:b,detected:a[b].detected}),a[b].detected&&(s++,$scope.Clean="notSafe")})},p=function(){c.downloads.search({id:$scope.downloadItem.id},function(a){"complete"!=a[0].state?($scope.percent=parseInt(100*(a[0].bytesReceived/a[0].fileSize)),$scope.percent||($scope.percent=0),$timeout(p,1e3)):"complete"===a[0].state&&($scope.percent=100,$scope.downloadComplete=!0,n()),$scope.$apply()})},i=function(a){var b,c,d;d=h,b=function(a,b,e){4>b?$timeout(function(){c(a,b,e)},d):($scope.Clean="notReport",$scope.isVerif=!0,$scope.$apply())},c=function(c,d,e){g.report(c.url).done(function(f){f&&1===f.response_code?(a||l(f.scans),$scope.isVerif=!0,$scope.$apply()):b(c,d+1,e)}).fail(function(){b(c,d+1,e)})},b($scope.downloadItem,1,new Date)},$scope.init=function(){var b=0;o(),g=new a.VirusTotal,h=15e3,q(b)},q=function(d){c.tabs.getCurrent(function(e){m=e.id,c.runtime.sendMessage({from:"scanner",to:"background",data:m,method:"getDlItem"},function(e){console.log(e),e.sdId?($scope.isWhiteList="wlist"==e.sdId.wlist?!0:!1,c.downloads.search({id:e.sdId.downloadId},function(c){$scope.downloadItem=c[0],$scope.name=$scope.downloadItem.filename,r("download",{wlist:$scope.isWhiteList,downloadItem:$scope.downloadItem}),p(),$scope.isWhiteList||(k=new a.VideoAds(b("#videoads"),{}),$timeout(j,1e4),$scope.isVideo=!0,i(e.sdId.wlist)),$scope.$apply()})):10>d&&$timeout(function(){d++,q(d++)},500)})})},r=function(a,b){c.runtime.sendMessage({from:"scanner",to:"background",method:"sendStats",vertical:a,data:b})},o=function(){window.onbeforeunload=function(){return"Do you want to cancel the download ?"}},n=function(){window.onbeforeunload=null}})}(sdl,jQuery,chrome);