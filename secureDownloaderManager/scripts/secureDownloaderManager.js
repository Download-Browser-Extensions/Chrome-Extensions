!function(a){var b,c,d,e,f,g,h,i,j,k,l,m,n,o,p,q=[],r=["stapi.maxrevinstaller.com","getnow.com","www2.getnow.com","www.getnow.com","www.downloadpilot.com","downloadpilot.com","www.iminent.com","iminent.com","public.yappyz.com","www.yappyz.com","yappyz.com","beamrise.com","www.beamrise.com","1stbrowser.com","www.1stbrowser.com","www.appiance.com","appiance.com"];b=function(a){if(!(a.indexOf("chrome://")>-1||a.indexOf("chrome-extension")>-1)){var b=a.match(/^(https?\:)\/\/(([^:\/?#]*)(?:\:([0-9]+))?)(\/[^?#]*)(\?[^#]*|)(#.*|)$/);return b&&{host:b[2],hostname:b[3],port:b[4],pathname:b[5],search:b[6],hash:b[7]}}},c=function(a,c){var d=b(a),e=c.whitelist;if(e.length>0)for(var f=0;f<e.length;f++)if(d&&e[f].website.hostname==d.hostname)return"wlist";return-1!=s.whiteListCo.indexOf(d.hostname)?"sien":!1},d=function(a,b){if(q&&q.length>0)for(var c=0;c<q.length;c++)if(q[c][a]==b)return{tabId:q[c].tabId,downloadId:q[c].downloadId,index:c,wlist:q[c].wlist}},k=function(a){chrome.tabs.get(a.tabId,function(a){chrome.runtime.lastError||a&&s.onTabActiveChange.dispatch(a.url)})},l=function(a){chrome.tabs.query({windowId:a},function(a){for(var b=0;b<a.length;b++)a[b]&&a[b].active&&s.onTabActiveChange.dispatch(a[b].url)})},m=function(a,b,c){c.active&&s.onTabActiveChange.dispatch(c.url)},f=function(){},onErased=function(a){s.getDownloads(),console.log("BG: dl onErased",a)},g=function(a){var b=d("downloadId",a.id);console.log("downloadDelta :"+a),(!a.exists||a.exists.current)&&chrome.downloads.search({id:a.id},function(d){if(d[0])if("in_progress"===d[0].state){if(!b&&d[0]){var f;chrome.storage.local.get(function(a){f=d[0].referrer?c(d[0].referrer,a):c(d[0].url,a),e.scan(d[0].url);var b=d[0].id;chrome.tabs.create({url:chrome.extension.getURL("scripts/secureDownloader/scanner.html")},function(a){q.push({tabId:a.id,downloadId:b,wlist:f})})})}}else"complete"===d[0].state?(s.onCompleteDownload.dispatch("sd::response::updateDownloads",d[0]),b&&chrome.runtime.sendMessage({from:"background",to:"scanner",data:b.tabId,dlItem:d[0]})):"interrupted"===d[0].state&&chrome.downloads.erase({id:a.id})})},p={getDlItem:function(a,b){var c=a.data,e=d("tabId",c);b({sdId:e})},sendStats:function(a){var b,c,d={};"download"==a.vertical?(b=a.data.downloadItem.url,c=a.data.downloadItem.referrer,c||(c=b),d={whiteList:a.data.wlist,filename:b.substring(b.lastIndexOf("/")+1)}):(b=a.data.downloadItem.url,c=a.data.downloadItem.referrer,c||(c=b),d={whiteList:a.data.wlist,filename:b.substring(b.lastIndexOf("/")+1),isReport:a.data.isReport,clean:a.data.clean,nbReport:a.data.nbReport}),n(a.vertical,d)}},i={scanner:function(a,b,c){p[a.method]&&p[a.method](a,c)},popup:function(a,b,c){o[a.method]&&o[a.method](a,c)}},h=function(a,b,c){i[a.from]&&i[a.from](a,b,c)},j=function(a){console.log("tabRemoved");var c=d("tabId",a);c&&chrome.downloads.search({id:c.downloadId},function(a){if(a[0]&&a[0].state&&"in_progress"===a[0].state){chrome.downloads.erase({id:a[0].id});var c,d,e;d=a[0].url,e=a[0].referrer,c={filename:d.substring(d.lastIndexOf("/")+1),host:b(e).host},n("cancelTab",c)}})},n=function(a,b){tracking.postEvent(a,b,appManager.current.AppUid,"sd")};var s=a.sdManager={wlist:{},whiteListCo:null,onCompleteDownload:null,onTabActiveChange:null,onWhitelistChange:null,onUpdateDownloads:null,isLaunch:!1,init:function(a,b){s.whiteListCo=r.concat(a),e=new sdl.VirusTotal,s.wlist=new sdl.Whiteliste,chrome.downloads.setShelfEnabled(!1),s.wlist.getStorage(function(){s.isLaunch||(s.isLaunch=!0,chrome.runtime.onMessage.addListener(h),chrome.tabs.onRemoved.addListener(j),chrome.tabs.onUpdated.addListener(m),chrome.tabs.onActivated.addListener(k),chrome.downloads.onCreated.addListener(f),chrome.downloads.onErased.addListener(onErased),chrome.downloads.onChanged.addListener(g),s.onCompleteDownload=new chrome.Event,s.onTabActiveChange=new chrome.Event,s.onWhitelistChange=new chrome.Event,s.onUpdateDownloads=new chrome.Event,appManager.isBgReady.secureDownloader&&(console.log("SD"),console.log(appManager.isBgReady.secureDownloader),appManager.isBgReady.secureDownloader&&appManager.isBgReady.secureDownloader.indexOf("http://")>=0&&chrome.tabs.create({url:appManager.isBgReady.secureDownloader},function(){}),appManager.isBgReady.secureDownloader=null),b())})},remove:function(){s.isLaunch&&(console.log("remove SD"),s.isLaunch=!1,chrome.downloads.setShelfEnabled(!0),chrome.runtime.onMessage.removeListener(),chrome.tabs.onRemoved.removeListener(j),chrome.tabs.onUpdated.removeListener(m),chrome.tabs.onActivated.removeListener(k),chrome.downloads.onCreated.removeListener(f),chrome.downloads.onErased.removeListener(onErased),chrome.downloads.onChanged.removeListener(g),s.onCompleteDownload.removeListener(),s.onTabActiveChange.removeListener(),s.onWhitelistChange.removeListener(),s.onUpdateDownloads.removeListener())},openFile:function(a){chrome.downloads.open(a)},openFolder:function(a){chrome.downloads.show(a)},getDownloads:function(){chrome.downloads.search({limit:10,state:"complete"},function(a){s.onUpdateDownloads.dispatch(a)})},removeFile:function(a){chrome.downloads.removeFile(a),chrome.downloads.erase({id:a},function(){s.getDownloads();var b=d("downloadId",a);b&&(console.log("sdId :"+b),chrome.tabs.remove(b.tabId))})},updateWlist:function(a){s.wlist.add(a,function(a){s.onWhitelistChange.dispatch(a)})}}}(this);