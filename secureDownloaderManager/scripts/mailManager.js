!function(a){function b(a){"noLogin"==a.state&&(chrome.windows.create({url:a.loginUrl,type:"popup",width:1e3}),chrome.tabs.onUpdated.addListener(function(b,c,d){bool=g[a.name].pattern.test(d.url),bool&&"noLogin"==a.state&&(chrome.windows.remove(d.windowId),g[a.name].getMails(a))}))}function c(a,b,c){a.step++;var d=new XMLHttpRequest;d.open("GET",b,!0),d.setRequestHeader("Accept","application/json"),d.onload=function(){if(200===this.status){var b=this.responseText;c(b,a)}else c(null,a)},d.onerror=function(){c(null,a)},d.send()}function d(a,b){if(1==b.step&&a){var e=a.indexOf('wssid:"');if(-1==e&&(b.state="noLogin",b.callback(b)),e>0){e+='wssid:"'.length,endPos=a.indexOf('"',e);var f=endPos-e,g=a.substr(e,f);c(b,b.url[b.step]+g,d)}else b.state="noLogin",b.callback(b)}else if(2==b.step&&a){console.log(a),b.messages=[];try{a=JSON.parse(a)}catch(h){}for(i=0;i<a.messageInfo.length;i++)0===a.messageInfo[i].flags.isRead&&b.messages.push(a.messageInfo[i].subject?{title:a.messageInfo[i].subject,from:a.messageInfo[i].from.email}:{title:"No Subject",from:a.messageInfo[i].from.email});b.count=b.messages.length,b.state=0===b.unread?"noMails":"mails",b.callback(b)}else b.state="noLogin",b.callback(b)}function e(a,b){if(a){b.messages=[],xmlMail=(new DOMParser).parseFromString(a,"text/xml");var c=xmlMail.querySelectorAll("entry");b.count=0;for(var d in c)"object"==typeof c[d]&&b.messages.push(c[d].querySelector("title").textContent?{from:c[d].querySelector("email").textContent,title:c[d].querySelector("title").textContent}:{from:c[d].querySelector("email").textContent,title:"No Subject"});b.count=b.messages.length,b.state=0===b.count?"noMails":"mails",b.state="mails"}else b.state="noLogin";b.callback(b)}function f(a,b){if(1==b.step){var d=a.indexOf('location.replace("');if(a.length<400&&d>0){d+='location.replace("'.length;var e=a.substring(d,a.indexOf('"',d));c(b,e,f)}else b.state="noLogin",b.callback(b)}else if(2==b.step){var g=a.indexOf('<ul id="folderListControlUl"');-1==g&&(b.state="noMails",b.callback(b));var h=a.indexOf("<div id=AddFldrInput>",g),i=$(a.substring(g,h)),j=0;$.each($("li.lnav_item",i),function(a,c){var d=$(c),e=d.attr("id");if("00000000-0000-0000-0000-000000000001"==e||-1==e.indexOf("00000000-0000-0000")){var f=parseInt(d.attr("count"),10);f&&(j+=f,b.count=j,b.state="mails",b.callback(b))}}),0===j&&(b.state="noMails",b.callback(b))}else b.state="noLogin",b.callback(b)}{var g={gmail:{getMails:function(a){c(a,a.url[a.step],e)},pattern:/^https:\/\/mail.google.com\/.*/gi},yahoo:{getMails:function(a){c(a,a.url[a.step],d)},pattern:/^https:\/\/.*\.mail.yahoo.com\/.*/gi},outlook:{getMails:function(a){c(a,a.url[a.step],f)},pattern:/^https:\/\/.*\.mail.live.com\/.*/gi}};a.mailManager={checkMail:function(a,c){a.mail.callback=c,a.mail.step=0,"noLogin"===a.mail.state&&a.login===!0?b(a.mail):g[a.mail.name].getMails(a.mail)}}}}(this);