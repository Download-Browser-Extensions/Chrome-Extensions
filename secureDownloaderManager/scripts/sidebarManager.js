!function(a){function b(a,c){return a?void chrome.sienium.getToolbars(a,function(b){b&&b.forEach(function(b){c(b,a)})}):chrome.windows.getCurrent(function(a){console.log(a),b(a.id,c)})}var c=341,d={length:0,windows:{},sidebarUrl:null,add:function(a){var b=this.sidebarUrl+"#wid="+a.id;return"normal"===a.type?(this.get(a.id)||chrome.sienium.addToolbar({id:-1,windowId:a.id,priority:10,dockingPoint:"RIGHT",orientation:"VERTICAL",x:0,y:0,width:1,height:0,width_overlap:0,height_overlap:0,contentURL:b,source:chrome.runtime.id,is_transparent:!0},function(b){d.windows[a.id]=b,d.length++}),e.display(appManager.current,a.id),!0):!1},remove:function(a){this.get(a)&&(delete this.windows[a],this.length--)},get:function(a){return this.windows[a]}},e={pool:null,hide:function(a){this.pool.postMessage({msg:"handle::hide"},a)},display:function(a,b){this.pool.postMessage({msg:"handle::display",app:appManager.current},b)},init:function(){var a=this;this.pool=portManager.pool("HANDLE_CHANNEL"),this.pool.onMessage.addListener(function(a,b){var c=b.sender.tab.windowId;f.toggle(c)}),this.pool.onConnect.addListener(function(c){b(c.sender.tab.windowId,function(b){b.width>2?a.hide():a.display(appManager.current)})})}};e.init();var f=a.sidebarManager={onAdded:new chrome.Event,onEmpty:new chrome.Event,canToggle:!0,displayed:1,initHandle:function(){e.display()},watch:function(a){d.sidebarUrl=a,chrome.windows.onCreated.addListener(function(a){d.add(a)&&f.onAdded.dispatch()}),chrome.windows.onRemoved.addListener(function(a){d.remove(a),d.length<=0&&f.onEmpty.dispatch()}),chrome.windows.getAll(function(a){var b=!1;a.forEach(function(a){b|=d.add(a)}),b?f.onAdded.dispatch():f.onEmpty.dispatch()}),chrome.tabs.onActivated.addListener(function(a){chrome.tabs.get(a.tabId,function(a){chrome.runtime.lastError||(-1!=a.url.indexOf("chrome-extension://")?(f.resize(a.windowId,c),e.hide(),f.displayed=0,f.canToggle=!1):(f.canToggle=!0,1===f.displayed&&(e.hide(),f.displayed=0)))})})},open:function(){e.hide(1),b(1,function(a){chrome.sienium.resizeToolbar({id:a.id,windowId:1,priority:10,dockingPoint:"RIGHT",orientation:"VERTICAL",x:0,y:0,width:c,height:0,width_overlap:0,height_overlap:0,contentURL:d.sidebarUrl+"#wid=1",source:chrome.runtime.id,is_transparent:!0},500,function(a){console.log(a)})})},toggle:function(a){f.canToggle&&b(a,function(a,b){a.source===chrome.runtime.id&&(a.width>2?(chrome.sienium.resizeToolbar({id:a.id,windowId:b,priority:10,dockingPoint:"RIGHT",orientation:"VERTICAL",x:0,y:0,width:1,height:0,width_overlap:0,height_overlap:0,contentURL:d.sidebarUrl+"#wid="+b,source:chrome.runtime.id,is_transparent:!0},500,function(a){console.log(a)}),e.display(appManager.current,b)):(e.hide(b),chrome.sienium.resizeToolbar({id:a.id,windowId:b,priority:10,dockingPoint:"RIGHT",orientation:"VERTICAL",x:0,y:0,width:c,height:0,width_overlap:0,height_overlap:0,contentURL:d.sidebarUrl+"#wid="+b,source:chrome.runtime.id,is_transparent:!0},500,function(a){console.log(a)}),-1!=navigator.userAgent.indexOf("Mac OS X")&&chrome.sienium.resizeToolbar({id:a.id,windowId:b,priority:10,dockingPoint:"RIGHT",orientation:"VERTICAL",x:0,y:0,width:c-1,height:0,width_overlap:0,height_overlap:0,contentURL:d.sidebarUrl+"#wid="+b,source:chrome.runtime.id,is_transparent:!0},500,function(a){console.log(a)})))})},ensureWindow:function(a){chrome.windows.getAll(function(b){b.filter(function(a){return"normal"===a.type}).length<=0?chrome.windows.create({},function(){a()}):a()})},resize:function(a,c){a=parseInt(a),isNaN(a)||b(a,function(b){b.source===chrome.runtime.id&&chrome.sienium.resizeToolbar({id:b.id,windowId:a,priority:10,dockingPoint:"RIGHT",orientation:"VERTICAL",x:0,y:0,width:c,height:0,width_overlap:0,height_overlap:0,contentURL:d.sidebarUrl+"#wid="+a,source:chrome.runtime.id,is_transparent:!0},1,function(a){console.log(a)})})},openWindow:function(a){var b=a?{url:a}:{};chrome.tabs.create(b,function(a){chrome.runtime.lastError,a||chrome.windows.create(b)})}}}(this);